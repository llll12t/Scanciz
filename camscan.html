<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCR ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #fafafa;
      padding: 20px;
    }

    .camera-container {
      position: relative;
      display: inline-block;
    }

    video {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
    }

    .frame-overlay {
      position: absolute;
      border: 3px dashed #00ff00;
      border-radius: 8px;
      width: 90%;
      height: 50%;
      top: 25%;
      left: 5%;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(0,255,0,0.7);
    }

    pre {
      text-align: left;
      max-width: 400px;
      margin: auto;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h2>

  <div class="camera-container">
    <video id="video" autoplay playsinline></video>
    <div class="frame-overlay"></div>
  </div>

  <canvas id="canvas" style="display: none;"></canvas>
  <pre id="result">üìÑ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö...</pre>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const result = document.getElementById('result');
    let scanning = true;

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á: " + err.message);
      });

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
    video.onloadeddata = () => {
      setTimeout(scanLoop, 1000); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    async function scanLoop() {
      if (!scanning) return;

      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏•‡∏á canvas
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // ‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á
      const x = canvas.width * 0.05;
      const y = canvas.height * 0.25;
      const w = canvas.width * 0.9;
      const h = canvas.height * 0.5;
      const cropped = ctx.getImageData(x, y, w, h);

      // ‡∏ß‡∏≤‡∏î cropped image ‡∏•‡∏á temporary canvas
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = w;
      tempCanvas.height = h;
      const tempCtx = tempCanvas.getContext('2d');
      tempCtx.putImageData(cropped, 0, 0);
      const base64Image = tempCanvas.toDataURL('image/png');

      result.textContent = "üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• OCR...";

      try {
        const { data: { text } } = await Tesseract.recognize(
          base64Image,
          'tha+eng',
          { logger: m => console.log(m) }
        );

        console.log("üìÑ OCR TEXT:", text);

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ/‡∏Ç‡∏µ‡∏î)
        const idMatch = text.match(/\d[\d\s\-]{11,20}/);

        if (idMatch) {
          scanning = false; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
          result.textContent = `‚úÖ ‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:\n\n${text}`;
        } else {
          result.textContent = "üì∑ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ ‡∏•‡∏≠‡∏á‡∏Ç‡∏¢‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏£‡∏≠‡∏ö ‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á";
        }

      } catch (err) {
        console.error("OCR Error:", err);
        result.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ï‡∏£";
      }

      if (scanning) {
        setTimeout(scanLoop, 1500); // ‡∏•‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      }
    }
  </script>
</body>
</html>

