<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>OCR ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      padding: 20px;
    }

    .camera-container {
      position: relative;
      display: inline-block;
    }

    video {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
    }

    /* ‡∏Å‡∏£‡∏≠‡∏ö Overlay */
    .frame-overlay {
      position: absolute;
      border: 3px dashed #00ff00;
      border-radius: 8px;
      width: 90%;
      height: 50%;
      top: 25%;
      left: 5%;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(0,255,0,0.7);
    }

    pre {
      text-align: left;
      max-width: 400px;
      margin: auto;
      background: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h2>üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h2>

  <div class="camera-container">
    <video id="video" autoplay playsinline></video>
    <div class="frame-overlay"></div>
  </div>

  <canvas id="canvas" style="display: none;"></canvas>
  <pre id="result">üìÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö...</pre>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const result = document.getElementById('result');
    let scanning = true;

    // ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + err));

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    video.onloadeddata = () => {
      setTimeout(checkFrameForIDCard, 1000);
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö
    async function checkFrameForIDCard() {
      if (!scanning) return;

      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å video
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // ‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á
      const x = canvas.width * 0.05;
      const y = canvas.height * 0.25;
      const w = canvas.width * 0.9;
      const h = canvas.height * 0.5;
      const imageData = ctx.getImageData(x, y, w, h);

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô base64
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = w;
      tempCanvas.height = h;
      tempCanvas.getContext('2d').putImageData(imageData, 0, 0);
      const base64Image = tempCanvas.toDataURL('image/png');

      result.textContent = "üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏û...";

      try {
        const { data: { text } } = await Tesseract.recognize(
          base64Image,
          'tha+eng',
          { logger: m => console.log(m) }
        );

        console.log("üìÑ OCR TEXT:", text);

        // ‡∏•‡∏≠‡∏á‡∏à‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á/‡∏Ç‡∏µ‡∏î)
        const idMatch = text.match(/\d[\d\s\-]{11,20}/);

        if (idMatch) {
          scanning = false;
          result.textContent = `‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:\n\n${text}`;
        } else {
          result.textContent = "üì∑ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡∏•‡∏≠‡∏á‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á";
        }

      } catch (e) {
        console.error("OCR Error:", e);
        result.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏û";
      }

      if (scanning) {
        setTimeout(checkFrameForIDCard, 1500); // ‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      }
    }
  </script>
</body>
</html>
