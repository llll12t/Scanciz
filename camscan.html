<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>OCR ‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { text-align: center; font-family: sans-serif; }
    .camera-container {
      position: relative;
      display: inline-block;
    }

    video {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
    }

    .frame-overlay {
      position: absolute;
      border: 3px dashed #00ff00;
      width: 90%;
      height: 50%;
      top: 25%;
      left: 5%;
      border-radius: 8px;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(0,255,0,0.7);
    }
  </style>
</head>
<body>
  <h2>‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h2>

  <div class="camera-container">
    <video id="video" autoplay></video>
    <div class="frame-overlay"></div>
  </div>

  <canvas id="canvas" style="display:none;"></canvas>
  <pre id="result">‡∏£‡∏≠‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û...</pre>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const result = document.getElementById('result');
    let scanning = true;

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err));

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö overlay
    async function checkFrameForIDCard() {
      if (!scanning) return;

      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å video
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // ‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö overlay (‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ 90% x 50%)
      const x = canvas.width * 0.05;
      const y = canvas.height * 0.25;
      const w = canvas.width * 0.9;
      const h = canvas.height * 0.5;
      const imageData = ctx.getImageData(x, y, w, h);

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô base64
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = w;
      tempCanvas.height = h;
      tempCanvas.getContext('2d').putImageData(imageData, 0, 0);
      const base64Image = tempCanvas.toDataURL('image/png');

      result.textContent = "üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£...";

      try {
        const { data: { text } } = await Tesseract.recognize(
          base64Image,
          'tha+eng',
          { logger: m => console.log(m) }
        );

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const idMatch = text.match(/\d{13}/);
        if (idMatch) {
          scanning = false;
          result.textContent = `üìÑ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n\n${text}`;
        } else {
          result.textContent = "üì∑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö...";
        }
      } catch (e) {
        console.error("OCR error", e);
      }

      if (scanning) {
        setTimeout(checkFrameForIDCard, 1500); // ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°
    video.onloadeddata = () => {
      setTimeout(checkFrameForIDCard, 1000);
    };
  </script>
</body>
</html>
